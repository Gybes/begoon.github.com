<link rel="stylesheet" href="default.css" type="text/css" />

<h1>Программируемый периферийный адаптер КР580ВВ55</h1>
<a href="http://www.computer-museum.ru/technlgy/i8255.htm">Оригинал статьи</a>.
<h3>(отечественный аналог INTEL 8255; старое наименование – К580ИК55)</h3>
<p>Вадим Кудрявцев</p>
<p>Любое устройство должно быть тем или иным образом связано с внешним миром. В микропроцессорной технике эту роль выполняют периферийные адаптеры. С их помощью центральный процессор получает данные, требующие той или иной обработки, управляет различными устройствами.</p>
<p>Программируемый периферийный адаптер (ППА) КР580ВВ55 представляет собой три канала ввода/вывода A, B и C по 8 бит каждый. Существует три режима работы микросхемы. В режиме 0 три упомянутых канала могут быть независимо друг от друга запрограммированы на ввод или вывод информации. Режим 1 позволяет передавать информацию по каналам A и B, используя отдельные биты канала C для управления обменом данными. В режиме 2 канал A приобретает свойство двунаправленной шины, управляемой опять же отдельными битами канала C. Кроме того, возможны установка и сброс отдельных битов канала C. Микросхема выпускается в 40-выводном DIP-корпусе.</p>
<p>Основные особенности микросхемы:</p>
<ul>
<li>3 канала ввода/вывода, 8 бит каждый;</li>
<li>3 режима работы (1 – статический ввод/вывод, 2 – тактируемый ввод/вывод, 3 – двунаправленный ввод/вывод);</li>
<li>раздельное программирование каждого канала на ввод или вывод.</li>
</ul>
<h2>Описание структуры и функционирование</h2>
<p>Структурная схема программируемого периферийного адаптера представлена на рис. 1.</p>

      <div><img src="i8255a.gif" width="416" height="410" border="0" alt="Структурная схема программируемого периферийного адаптера КР580ВВ55" title="Структурная схема программируемого периферийного адаптера КР580ВВ55">
   <p>
  Структурная схема программируемого периферийного адаптера КР580ВВ55    
</p></div>

<p>ППА структурно разбит на две группы (A и B). Группа A включает в себя канал A и старшую тетраду канала C. Группа B состоит из канала B и младшей тетрады канала C. Доступ к каналам ввода/вывода и регистру управления осуществляется с помощью логики чтения-записи в соответствии с табл. 1.</p>
<p>Таблица 1. Доступ к каналам ввода/вывода и регистру управляющего слова</p>
<table cellspacing="0" >
  <tr>
    <th >A1</th>
    <th >A0</th>
    <th >/RD</th>
    <th >/WR</th>
    <th >/CS</th>
    <th >&nbsp;</th>
  </tr>
  <tr>
    <td >0</td>
    <td >0</td>
    <td >0</td>
    <td >1</td>
    <td >0</td>
    <td >Шина данных &lt;- канал A</td>
  </tr>
  <tr>
    <td >0</td>
    <td >1</td>
    <td >0</td>
    <td >1</td>
    <td >0</td>
    <td >Шина данных &lt;- канал B</td>
  </tr>
  <tr>
    <td >1</td>
    <td >0</td>
    <td >0</td>
    <td >1</td>
    <td >0</td>
    <td >Шина данных &lt;- канал C</td>
  </tr>
  <tr>
    <td >1</td>
    <td >1</td>
    <td >0</td>
    <td >1</td>
    <td >0</td>
    <td >Данные не определены</td>
  </tr>
  <tr>
    <td >0</td>
    <td >0</td>
    <td >1</td>
    <td >0</td>
    <td >0</td>
    <td >Шина данных -&gt; канал A</td>
  </tr>
  <tr>
    <td >0</td>
    <td >1</td>
    <td >1</td>
    <td >0</td>
    <td >0</td>
    <td >Шина данных -&gt; канал B</td>
  </tr>
  <tr>
    <td >1</td>
    <td >0</td>
    <td >1</td>
    <td >0</td>
    <td >0</td>
    <td >Шина данных -&gt; канал C</td>
  </tr>
  <tr>
    <td >1</td>
    <td >1</td>
    <td >1</td>
    <td >0</td>
    <td >0</td>
    <td >Шина данных -&gt; регистр управления</td>
  </tr>
  <tr>
    <td >X</td>
    <td >Х</td>
    <td >Х</td>
    <td >Х</td>
    <td >1</td>
    <td >Шина данных в высокоомном состоянии</td>
  </tr></table>
<p>Назначение этих и остальных выводов микросхемы приведено в табл. 2.</p>
<p>Таблица 2. Назначение выводов</p>
<table cellspacing="0" >
  <tr>
    <td >D0…D7</td>
    <td >Двунаправленная шина данных. Предназначена для передачи и приема данных процессором, а также передачи управляющих команд и слова состояния</td>
  </tr>
  <tr>
    <td >/CS</td>
    <td >Chip Select. Выбор микросхемы. Низкий уровень инициирует обмен между процессором и ППА</td>
  </tr>
  <tr>
    <td >/RD</td>
    <td >Read. Чтение. Низкий уровень на этом входе позволяет ППА передать данные или слово состояния процессору</td>
  </tr>
  <tr>
    <td >/WR</td>
    <td >Write. Запись. Низкий уровень на этом входе позволяет ППА принять данные или управляющую команду</td>
  </tr>
  <tr>
    <td >RESET</td>
    <td >Reset. Сброс. Высокий уровень на этом входе сбрасывает все внутренние регистры, включая регистры управления, переключает все каналы (A, B, C) в режим 0, одновременно переводя их в режим ввода (только при /RD = 0 и /WR = 0)</td>
  </tr>
  <tr>
    <td >A0, A1</td>
    <td >Адресные входы. Выбор канала. Позволяют выбрать один из каналов (A, B, C) или регистры управляющего слова и состояния (в зависимости от сигналов на входах /RD и /WR, см. табл. 2)</td>
  </tr>
  <tr>
    <td >PA0…PA7</td>
    <td >Канал A</td>
  </tr>
  <tr>
    <td >PB0…PB7</td>
    <td >Канал B</td>
  </tr>
  <tr>
    <td >PC0…PC7</td>
    <td >Канал C</td>
  </tr></table>
<p>Первоначальное включение или подача сигнала высокого уровня на вход сброс RESET микросхемы переключает все каналы (A, B, C) в режим 0, одновременно переводя их в режим ввода. Сброс выполняется только при условии  /RD = 0 и /WR = 0.</p>
<p>Режим работы и направление передачи для каждого канала задается с помощью записи управляющего слова в регистр управления в соответствии с табл. 3 или 4. Отметим возможность комбинирования режимов работы для разных каналов. К примеру, канал B может быть запрограммирован на вывод в режим 0 для управления различными выключателями и реле, в то время как канал A может быть запрограммирован в режим 1 для ввода с клавиатуры или перфоленты.</p>
<p>Таблица 3. Формат управляющего слова для выбора режима работы</p>
<table cellspacing="0" >
  <tr>
    <th >D7</th>
    <th >D6</th>
    <th >D5</th>
    <th >D4</th>
    <th >D3</th>
    <th >D2</th>
    <th >D1</th>
    <th >D0</th>
  </tr>
  <tr>
    <td >Флаг управления<br>
      1 = выбор режима</td>
    <td colspan="4" >Группа A</td>
    <td colspan="3" >Группа В</td>
  </tr>
  <tr>
    <td >&nbsp;</td>
    <td colspan="2" >Выбор режима:<br>
      00 = режим 0<br>01 = режим 1<br>1х = режим 2</td>
    <td >Канал A:<br>
      1 = ввод<br>0 = вывод</td>
    <td >Старшая тетрада канала C:<br>
      1 = ввод<br>0 = вывод</td>
    <td >Выбор режима:<br>
      0 = режим 0<br>1 = режим 1</td>
    <td >Канал B:<br>
      1 = ввод<br>0 = вывод</td>
    <td >Младшая тетрада канала C:<br>
      1 = ввод<br>0 = вывод</td>
  </tr></table>
<p>Таблица 4. Формат управляющего слова для двунаправленного режима.</p>
<table cellspacing="0" >
  <tr>
    <td >D7</td>
    <td >D6</td>
    <td >D5</td>
    <td >D4</td>
    <td >D3</td>
    <td >D2</td>
    <td >D1</td>
    <td >D0</td>
  </tr>
  <tr>
    <td >Флаг управления<br>
      1 = выбор режима</td>
    <td >Выбор режима:<br>
      1 = режим 2</td>
    <td colspan="3" >Произвольное состояние</td>
    <td >Выбор режима для канала B:<br>
      0 = режим 0<br>1 = режим 1</td>
    <td >Канал B:<br>
      1 = ввод<br>0 = вывод</td>
    <td >Биты 0..2 канала C:<br>
      1 = ввод<br>0 = вывод</td>
  </tr></table>
<p>Каждый из восьми битов канала C может быть независимо от других установлен или сброшен с помощью специальной команды вывода, посылаемой в регистр управления. Это свойство канала C облегчает программирование в случае, когда биты канала C используется для управления передачей данных по каналам A или B. Формат команды приведен в табл. 5.</p>
<p>Работа микросхемы в режиме 1 или 2 характеризуется наличием управляющих сигналов, которые могут вызывать прерывание работы процессора КР580ВМ80.</p>
<p>Команда установки или сброса соответствующего бита канала C позволяет запретить или разрешить выдачу требуемого прерывания.</p>
<p>Таблица 5. Оперирование битами</p>
<table cellspacing="0" >
  <tr>
    <td >D7</td>
    <td >D6</td>
    <td >D5</td>
    <td >D4</td>
    <td >D3</td>
    <td >D2</td>
    <td >D1</td>
    <td >D0</td>
  </tr>
  <tr>
    <td >Флаг управления<br>
      0 = оперирование битами</td>
    <td colspan="3" >Произвольное состояние</td>
    <td colspan="3" >Выбор бита:<br>
      0 0 0 = 0 бит<br>0 0 1 = 1 бит<br>0 1 0 = 2 бит<br>0 1 1 = 3 бит<br>1 0 0 = 4 бит<br>1 0 1 = 5 бит<br>1 1 0 = 6 бит<br>1 1 1 = 7 бит</td>
    <td >1 = установить бит<br>
      0 = снять бит</td>
  </tr></table>
<h2>Описание режимов работы</h2>
<h3>Режим 0 (простой ввод/вывод)</h3>
<p>Работа в этом режиме позволяет организовать простой ввод или вывод для каждого из трех каналов. Данные просто записываются или считываются из выбранного канала. Таким образом, основные особенности функционирования микросхемы в режиме 0 следующие:</p>
<ul>
<li>два 8-битовых канала (каналы A и B) и два 4-битовых канала (старшая и младшая половинки канала C);</li>
<li>каждый канал может быть независимо от других запрограммирован на ввод или вывод; таким образом, всего может быть 16 различных комбинаций ввода/вывода;</li>
<li>выходы имеют память, входы работают без буферной памяти.</li>
</ul>
<h3>Режим 1 (тактируемый ввод/вывод)</h3>
<p>Этот режим служит для однонаправленного обмена данными по выбранному каналу с периферийным устройством. Для управления передачей или приемом по каналу A используется младшая тетрада канала C, канал B управляется старшей тетрадой канала C.</p>
<p>Основные особенности работы в данном режиме:</p>
<ul>
<li>два канала (каналы A и B);</li>
<li>каждый канал может быть запрограммирован на вход или выход;</li>
<li>одна тетрада канала C используется для управления одного канала передачи данных.</li>
</ul>
<p>Описание сигналов для управления операцией ввода</p>
<p>/STB (STROBE)</p>
<p>По низкому уровню на этом входе входные данные записываются в буферную память.</p>
<p>/IBF (INPUT BUFFER FULL)</p>
<p>Высокий уровень на этом выходе показывает, что данные загружены в буферную память. Задний фронт сигнала /STB устанавливает этот выход в уровень лог. 1, передний фронт сигнала на входе /RD сбрасывает его в лог. 0.</p>
<p>INTR (INTERRUPT)</p>
<p>Высокий уровень на этом выходе может быть использован для прерывания выполнения основной программы процессора, чтобы обслужить устройство ввода. Сигнал INTR устанавливается в лог. 1 по переднему фронту сигнала /STB (если установлен сигнал INTE разрешения прерывания) и сбрасывается по заднему фронту сигнала на входе /RD микросхемы. Этот процесс обеспечивает ввод данных в микропроцессор со стороны устройства ввода простым стробированием своих данных.</p>
<p>INTE A</p>
<p>Разрешение прерывания для канала A. Управляется установкой/сбросом бита 4 канала С.</p>
<p>INTE B</p>
<p>Разрешение прерывания для канала B. Управляется установкой/сбросом бита 2 канала С.</p>
<p>Взаимодействие описанных сигналов показано на рис. 2.</p>

      <div><img src="http://www.computer-museum.ru/images/technlgy/i8255b.gif" width="407" height="205" border="0" alt="Работа ППА в режиме 1 (тактируемый ввод)" title="Работа ППА в режиме 1 (тактируемый ввод)">
      <!-- ImageId=128 -->
   <p>
  Работа ППА в режиме 1 (тактируемый ввод)    
</p></div>

<p>Описание сигналов для управления операцией вывода</p>
<p>/OBF (OUTPUT BUFFER FULL)</p>
<p>Сигнал высокого уровня на этом выходе показывает устройству вывода, что микропроцессор записал данные в канал. Сигнал устанавливается в лог. 1 по переднему фронту на входе /WR микросхемы и сбрасывается по заднему фронту сигнала /ACK.</p>
<p>/ACK (ACKNOWLEDGEMENT)</p>
<p>Низкий уровень на этом выходе показывает микропроцессору, что периферийное устройство приняло данные.</p>
<p>INTR (INTERRUPT)</p>
<p>Высокий уровень на этом выходе может быть использован для прерывания выполнения основной программы процессора в момент принятия данных периферийным устройством. Сигнал INTR устанавливается в лог. 1 по переднему фронту сигнала /ACK (если одновременно сигналы /OBF и INTE установлены в лог. 1) и сбрасывается по заднему фронту сигнала на входе /WR микросхемы.</p>
<p>INTE A</p>
<p>Разрешение прерывания для канала A. Управляется установкой/сбросом бита 6 канала С.</p>
<p>INTE B</p>
<p>Разрешение прерывания для канала B. Управляется установкой/сбросом бита 2 канала С.</p>
<p>Взаимодействие описанных сигналов показано на рис. 3.</p>

      <div><img src="http://www.computer-museum.ru/images/technlgy/i8255c.gif" width="380" height="210" border="0" alt="Работа ППА в режиме 1 (тактируемый вывод)" title="Работа ППА в режиме 1 (тактируемый вывод)">
      <!-- ImageId=129 -->
   <p>
  Работа ППА в режиме 1 (тактируемый вывод)    
</p></div>

<h3>Режим 2 (двунаправленный тактируемый ввод/вывод)</h3>
<p>В этом режиме возможен обмен данными по 8-битовой двунаправленной шине данных. Управление обменом данными, а также направление передачи задается с помощью управляющих сигналов аналогичным режиму 1 способом. Возможно также генерирование сигналов прерываний и запрета разрешения.</p>
<p>Основные особенности работы в данном режиме:</p>
<ul>
<li>возможно использование только канала A;</li>
<li>управление обменом обеспечивается 5 битами канала C;</li>
<li>входы и выходы обладают буферной памятью.</li>
</ul>
<p>Описание управляющих сигналов для двунаправленного ввода/вывода</p>
<p>INTR (INTERRUPT)</p>
<p>Высокий уровень на этом выходе может быть использован для прерывания выполнения основной программы процессора.</p>
<p>Режим вывода</p>
<p>/OBF (OUTPUT BUFFER FULL)</p>
<p>Сигнал высокого уровня на этом выходе показывает устройству вывода, что микропроцессор записал данные в канал A.</p>
<p>/ACK (ACKNOWLEDGEMENT)</p>
<p>Низкий уровень на этом выходе выводит выходной буфер канала A из третьего состояния для вывода данных в периферийное устройство. В остальных случаях выходной буфер остается в третьем состоянии.</p>
<p>INTE 1 (INTE плюс /OBF)</p>
<p>Разрешение прерывания для канала A при работе на вывод. Управляется установкой/сбросом бита 6 канала С.</p>
<p>Режим ввода</p>
<p>/STB (STROBE)</p>
<p>Низкий уровень на этом входе загружает данные из периферийного устройства в буферную память канала A.</p>
<p>/IBF (INPUT BUFFER FULL)</p>
<p>Высокий уровень на этом выходе показывает, что данные загружены в буферную память.</p>
<p>INTE 2 (INTE плюс /IBF)</p>
<p>Разрешение прерывания для канала A при работе на вывод. Управляется установкой/сбросом бита 4 канала С.</p>
<p>Работа ППА в режиме 2 показана на рис. 4.</p>

      <div><img src="http://www.computer-museum.ru/images/technlgy/i8255d.gif" width="404" height="327" border="0" alt="Работа ППА в режиме 2" title="Работа ППА в режиме 2">
      <!-- ImageId=130 -->
   <p>
  Работа ППА в режиме 2    
</p></div>

<p>Таблица 5. Управляющие сигналы для различных режимов работы</p>
<table cellspacing="0" >
  <tr>
    <th >C7</th>
    <th >C6</th>
    <th >C5</th>
    <th >C4</th>
    <th >C3</th>
    <th >C2</th>
    <th >C1</th>
    <th >C0</th>
    <th >&nbsp;</th>
  </tr>
  <tr>
    <td colspan="5" >Канал A</td>
    <td colspan="3" >Канал B</td>
    <td >Режим 1<br>
      Ввод</td>
  </tr>
  <tr>
    <td >I/O</td>
    <td >I/O</td>
    <td >/IBF</td>
    <td >/STB</td>
    <td >INTR</td>
    <td >/STB</td>
    <td >/IBF</td>
    <td >INTR</td>
    <td >&nbsp;</td>
  </tr>
  <tr>
    <td colspan="5" >Канал A</td>
    <td colspan="3" >Канал B</td>
    <td >Режим 1<br>
      Вывод</td>
  </tr>
  <tr>
    <td >/OBF</td>
    <td >/ACK</td>
    <td >I/O</td>
    <td >I/O</td>
    <td >INTR</td>
    <td >/ACK</td>
    <td >/OBF</td>
    <td >INTR</td>
    <td >&nbsp;</td>
  </tr>
  <tr>
    <td colspan="5" >Канал A</td>
    <td colspan="3" >&nbsp;</td>
    <td >Режим 2</td>
  </tr>
  <tr>
    <td >/OBF</td>
    <td >/ACK</td>
    <td >/IBF</td>
    <td >/STB</td>
    <td >INTR</td>
    <td >I/O</td>
    <td >I/O</td>
    <td >I/O</td>
    <td >&nbsp;</td>
  </tr></table>
<p>Примечание: I/O – обычный ввод/вывод.</p>
<h2>Пример программирования</h2>
<p>Сразу замечу – использование режимов 1 и 2 подразумевает относительно &quot;разумную&quot; реакцию внешних устройств на сигналы ППА, что сопряжено с усложненной схемотехникой последних. В большинстве же случаев можно обойтись режимом 0 простого ввода/вывода.</p>
<p>В составе одноплатного компьютера &quot;Радио-86РК&quot;, описанного в журнале &quot;Радио&quot;, используются два ППА. Первый обслуживает клавиатуры, индикацию раскладок клавиатуры и ввод/вывод данных с магнитофона. Второй используется для сопряжения с различными устройствами и его программирование должен осуществлять сам пользователь или программист-разработчик драйвера под конкретное внешнее устройство.</p>
<p>Рассмотрим программирование первого ППА.</p>
<p>Основная матрица клавиатуры размером 8x8 подключена к каналам A и B, причем канал A должен работать на вывод, а канал B на ввод информации. К выводам C5, C6, C7 канала C подключены дополнительные клавиши управления регистрами. Вывод C4 используется для ввода данных с магнитной ленты. Следовательно, старшая тетрада канала C должна быть запрограммирована на ввод. В младшей тетраде канала C используются только два бита: C0 – вывод данных на магнитную ленту и C3 – индикация раскладки клавиатуры &quot;Рус/Лат&quot;. Следовательно, младшая тетрада канала C должна быть запрограммирована на вывод.</p>
<p>Программирование производится засылкой одного байта в управляющий регистр.</p>
<p>Таблица 6. Программирование ППА для обслуживания клавиатуры</p>
<table cellspacing="0" >
  <tr>
    <th colspan="2" >Адрес</th>
    <th colspan="8" >Данные</th>
  </tr>
  <tr>
    <td >A1</td>
    <td >A0</td>
    <td >D7</td>
    <td >D6</td>
    <td >D5</td>
    <td >D4</td>
    <td >D3</td>
    <td >D2</td>
    <td >D1</td>
    <td >D0</td>
  </tr>
  <tr>
    <td >1</td>
    <td >1</td>
    <td >1</td>
    <td >0</td>
    <td >0</td>
    <td >0</td>
    <td >1</td>
    <td >0</td>
    <td >0</td>
    <td >1</td>
  </tr>
  <tr>
    <td colspan="2" >Регистр управления</td>
    <td >Режим программирования</td>
    <td colspan="2" >Канал A режим 0</td>
    <td >Канал A вывод</td>
    <td >Старшая тетрада канала C ввод</td>
    <td >Канал B режим 0</td>
    <td >Канал B ввод</td>
    <td >Младшая тетрада канала C вывод</td>
  </tr></table>
<p>Как видно из этого примера, все каналы ППА запрограммированы в режим 0 простого ввода-вывода, т. е. разработчики упомянутого компьютера решили пойти по пути упрощения схемотехники и переложить большую часть обработки клавиатуры и периферийных устройств на процессор.</p>
<p>С помощью второго ППА я в свое время эмулировал LPT-порт и подключал к нему матричный принтер. Обходился я опять же программированием всех каналов только в режим 0 и всю обработку обмена с принтером писал на ассемблере.</p>
<p>В заключение отмечу, что описанная микросхема оказалась очень удачной для создания компактных устройств ввода/вывода. В своей практике я ее не раз использовал для увеличения количества внешних линий однокристальных микро-ЭВМ или построения плат ввода/вывода для шин стандарта ISA IBM-совместимых компьютеров.</p>
<p>Литература:</p>
<ol>
<li><span>Kramer M., Wurtenberger S.</span> <span>Datenbuch Mikrorechner Schalkreise.</span> 1. Auflage. Berlin: Militarverlag der DDR (VEB), 1989.</li>
<li><span>Микропроцессоры.</span> Справочное пособие для разработчиков судовой РЭА. Под ред. Ю. А. Овечкина. Л., &quot;Судостроение&quot;, 1988.</li>
<li><span>Зеленко Г., Панов В., Попов С.</span> <span>Модуль программатора ППЗУ.</span> Радио, 1983, № 6, с. 42–46.</li>
</ol>
<p>Статья опубликована 23.01.2003 г.</p>
